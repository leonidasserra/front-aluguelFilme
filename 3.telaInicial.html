<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8" />
    <title>Home</title>
</head>

<body>
    <!-- Barra Superior -->
    <!-- <header class="header">
        <div class="logo">
            <h1>RentFlix</h1>
        </div>
    </header> -->

    <!-- Sidebar -->
<div class="sidebar">
    <ul>
        <a href="3.telaInicial.html">Home</a>
        <br>
        <a href="5.pessoas.html">Ver Clientes</a>
        <br>
        <a href="2.cadastro.html">Novo Cliente</a>
        <br>
        <a href="6.novoFilme.html">Novo Filme</a>
        <br>
        <a href="javascript:history.back()">Voltar</a>
        <br>
        <a href="1.login.html" id="exit-btn">Sair</a>
    </ul>
</div>

    <!-- Conte√∫do Principal -->
    <main class="main-content">
        <div class="top-page">
            <div class="page-title-home">
                <h1>Filmes</h1>
            </div>
            <div class="searchbar">
                <input type="text" name="q" placeholder="Digite sua busca...">
                <button type="button">üîç</button>
            </div>
        </div>    
        <div class="home-content"></div>
            <form action="4.fazerAluguel.html">
                <!-- <div class="float-btn"> -->
                    <button type="button" class="float-btn" id="next-home-btn">Seguinte</button>
                <!-- </div> -->
                <!-- <div class="filmes" data-id="1">
                    <h2>Filme 1</h2>
                    <div class="inner-filme">
                        <a href="/filmes/1" class="detalhes-btn">Ver Detalhes</a>
                        <button type="button" class="add-filme-btn">Adicionar</button>
                    </div>
                </div>

                <div class="filmes" data-id="2">
                    <h2>Filme 2</h2>
                    <div class="inner-filme">
                        <a href="/filmes/2" class="detalhes-btn">Ver Detalhes</a>
                        <button type="button" class="add-filme-btn">Adicionar</button>
                    </div>
                </div>

                <div class="filmes" data-id="3">
                    <h2>Filme 3</h2>
                    <div class="inner-filme">
                        <a href="/filmes/3" class="detalhes-btn">Ver Detalhes</a>
                        <button type="button" class="add-filme-btn">Adicionar</button>
                    </div>
                </div> -->

                <table id="tabela_filmes">
                    <thead>
                        <tr>
                            <td>C√≥digo</td>
                            <td>T√≠tulo</td>
                            <td>G√™nero</td>
                            <td>Ano</td>
                            <td>Estoque</td>
                            <td>A√ß√µes</td>
                        </tr>
                    </thead>
                    <tbody id="corpo_tabela_filmes">
                        <!-- <tr>
                            <td>0</td>
                            <td><a href="3.1.detalhesFilme-Aluguel.html">Senhor dos An√©is: A Sociedade do Anel</a></td>
                            <td>Fantasia</td>
                            <td>2001</td>
                            <td>12</td>
                            <td><input type="checkbox" class="checkbox" ></input></td>
                        </tr> -->
                    </tbody>
                </table>

                <br><br>

            </form>
        </div>

        <!-- Pagina√ß√£o -->
        <nav class="pagination" aria-label="Navega√ß√£o de p√°ginas">
            <ul>
                <li><a href="?page=1" class="active">1</a></li>
                <li><a href="?page=2">2</a></li>
                <li><a href="?page=3">3</a></li>
                <li><a href="?page=2">Pr√≥ximo</a></li>
            </ul>
        </nav>

        <!-- Bot√£o de Configura√ß√µes -->
        <!-- <div>
            <form action="configuracoes.html" method="get">
                <button type="submit" class="config-btn">Configura√ß√µes</button>
            </form>
        </div> -->
    </main>
</body>
<script>


  window.onload = function () {
            fetch('http://localhost:8080/filme/listar')
                .then((response) => response.json())
                .then((data) => {
                    console.log(data);
                    let listaFilmes = document.getElementById("filmes");
                    
                    data.forEach((filme) => {
                        const linha = document.createElement("tr");
                        const celulaId = document.createElement("td");
                        celulaId.textContent = filme.id;
                        linha.appendChild(celulaId);

                        const celulaTitle = document.createElement("td");
                        celulaTitle.textContent = filme.title;
                        linha.appendChild(celulaTitle);

                        const celulaGenero = document.createElement("td");
                        celulaGenero.textContent = filme.genero;
                        linha.appendChild(celulaGenero);

                        const celulaAno = document.createElement("td");
                        celulaAno.textContent = filme.ano;
                        linha.appendChild(celulaAno);

                        const celulaEstoque = document.createElement("td");
                        celulaEstoque.textContent = filme.quantidadeEstoque;
                        linha.appendChild(celulaEstoque);
                        

                        const celulaCheckbox = document.createElement("td");
                        const checkbox = document.createElement("input");
                        checkbox.type = 'checkbox';
                        checkbox.className = 'checkbox'
                        checkbox.value = filme.id;
                        celulaCheckbox.appendChild(checkbox);
                        linha.appendChild(celulaCheckbox);


                        const dadosTabela=document.getElementById("corpo_tabela_filmes");
                        dadosTabela.appendChild(linha);

                });
            })
            .catch(error => console.error('Erro ao buscar filmes:', error));
        }


  // --- bloco do modal: s√≥ ativa se existir na p√°gina ---
  const btnConfirmar = document.querySelector('.rent-btn');
  const overlay = document.getElementById('overlay');
  const confirmBox = document.getElementById('confirmBox');
  const btnSim = document.getElementById('btnSim');
  const btnNao = document.getElementById('btnNao');
  const form = document.querySelector('form');

  if (btnConfirmar && overlay && confirmBox && btnSim && btnNao && form) {
    btnConfirmar.addEventListener('click', function(event) {
      event.preventDefault();
      overlay.classList.add('active');
      confirmBox.classList.add('active');
    });

    btnSim.addEventListener('click', function() {
      form.submit();
    });

    btnNao.addEventListener('click', function() {
      overlay.classList.remove('active');
      confirmBox.classList.remove('active');
    });
  }

  // --- checkboxes: pinta/despinta a linha ---
//   document.querySelectorAll('.checkbox').forEach(checkbox => {
//     checkbox.addEventListener('change', function() {
//       const row = this.closest('tr');
//       row.classList.toggle('selected-row', this.checked);
//     });
//   });

const corpoTabela = document.getElementById("corpo_tabela_filmes"); 


corpoTabela.addEventListener('change', function(event) {
  // Verifise oque mudou foi checkbox
  if (event.target.matches('.checkbox')) {

    const checkbox = event.target; // event.target √© o checkbox espec√≠fico que foi alterado
    const row = checkbox.closest('tr');
    row.classList.toggle('selected-row', checkbox.checked);
  }
});

const btnAvan√ßar = document.getElementById("next-home-btn")
btnAvan√ßar.addEventListener('click', function() {

   const checkboxesMarcados = document.querySelectorAll('.checkbox:checked');

    const idsSelecionados = [];

    checkboxesMarcados.forEach(checkbox=>{
        idsSelecionados.push(parseInt(checkbox.value));
    });
    // 4. Verifica se o usu√°rio selecionou pelo menos um filme
    if (idsSelecionados.length === 0) {
        alert('Por favor, selecione pelo menos um filme para continuar.');
        window.reset();
    }

    sessionStorage.setItem('filmesSelecionados', JSON.stringify(idsSelecionados));
    window.location.href = "4.fazerAluguel.html";
}
);
localStorage.clear();

</script>
</html>
